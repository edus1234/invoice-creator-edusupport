# 請求書自動作成システム（EduSupport専用版）

## プロジェクト概要
- **プロジェクト名**: 請求書自動作成システム
- **対象**: 株式会社EduSupport向け業務委託・フリーランス（複数スタッフ対応）
- **形式**: 業務委託標準レイアウト（交通費対応・PDF1ページ収まり・智能支払期限・請求先固定）
- **目標**: 株式会社EduSupport専用で作業実態に基づく正確な請求書を効率的に作成

## 🎯 主な機能（完全実装済み）

### ✅ **NEW: 交通費完全対応機能**
- **8種類の交通手段**: 電車・新幹線・バス・タクシー・自家用車・航空機・地下鉄・その他
- **詳細項目**: 日付・場所・交通手段・金額・メモ
- **自動合計計算**: 交通費の個別・合計金額を自動計算
- **税込み分離**: 交通費は非課税として別計算

### ✅ **NEW: PDF1ページ最適化**
- **コンパクト設計**: フォントサイズ・余白・レイアウトをPDF用に最適化
- **印刷専用スタイル**: 11px基本フォント・1.3行間・15px余白
- **テーブル最適化**: 作業項目・交通費テーブルのサイズ調整
- **1ページ保証**: A4サイズ1ページに確実に収まる設計

### ✅ **NEW: 智能支払期限計算**
- **作業最終日ベース**: 作業項目の最終日の翌月末を自動計算
- **リアルタイム更新**: 作業日付変更時に支払期限を即座に再計算
- **フォールバック機能**: 作業項目がない場合は発行日翌月末を適用
- **自動追従**: 作業項目追加・削除・変更時の自動更新

### ✅ **NEW: 請求先固定機能**
- **固定請求先**: 株式会社EduSupport
- **固定住所**: 東京都新宿区西新宿3-3-13 西新宿水間ビル6F
- **読み取り専用**: 請求先情報は編集不可で常に固定値を表示
- **データ効率**: 請求先情報はデータ保存対象外で軽量化

### ✅ 複数スタッフ対応機能
- **個人識別システム**: 各スタッフが独自の識別名でデータを管理
- **データ完全分離**: 他のスタッフの保存データは表示されない
- **プライバシー保護**: 個人別のローカルストレージ領域を使用

### ✅ プルダウン式作業内容選択
- **10種類の定型作業**: イベント、研究会参加、ミーティング参加等
- **「その他」オプション**: 具体的な作業内容を手入力
- **効率的な入力**: よくある作業項目を素早く選択

### ✅ グローバル時給設定
- **統一時給管理**: 1つの時給設定で全作業項目に適用
- **一括金額更新**: 時給変更時に全項目の金額を自動再計算
- **入力効率向上**: 項目ごとの時給入力が不要

## 🌐 アクセス情報
- **アプリケーションURL**: https://3000-ig8o8l6emgtm4kj84zjm0-6532622b.e2b.dev
- **API ヘルスチェック**: https://3000-ig8o8l6emgtm4kj84zjm0-6532622b.e2b.dev/api/health

## 💼 交通費機能の詳細

### 🚗 対応交通手段（プルダウン選択）
1. **電車** - 在来線での移動
2. **新幹線** - 長距離高速移動
3. **バス** - 路線バス・高速バス
4. **タクシー** - タクシー利用
5. **自家用車** - ガソリン代・駐車場代等
6. **航空機** - 国内線・国際線
7. **地下鉄** - 都市部地下鉄
8. **その他** - 船舶・レンタカー等

### 📋 入力項目
- **日付**: 交通費発生日（必須）
- **場所**: 出発地→到着地（必須）
- **交通手段**: プルダウンから選択（必須）
- **金額**: 実費金額（必須）
- **メモ**: 詳細情報（任意）

### 💰 計算方式
- **交通費は非課税**: 消費税計算の対象外
- **作業代金は課税**: 時給×時間に消費税適用
- **合計計算**: 作業代金（税込） + 交通費 = 総請求額

## 📊 データ構造（最新版）

### 💼 作業項目
```
日付 + 作業内容（プルダウン） + 時間 + （グローバル時給） → 金額
```

### 🚗 交通費項目
```
日付 + 場所 + 交通手段（プルダウン） + 金額 + メモ
```

### 💰 合計計算
```
作業代金: ¥XX,XXX（税抜き・税込み対応）
交通費:   ¥X,XXX（非課税）
消費税:   ¥XXX（作業代金のみ）
────────────────
合計:     ¥XX,XXX
```

## 📱 使い方（交通費対応版）

### 1. **基本設定**
- **個人識別**: 複数スタッフ利用時の識別名
- **時給**: 全作業項目に適用される統一時給
- **基本情報**: 請求先・発行者・振込先情報

### 2. **作業項目の入力**
- **日付**: 作業実施日
- **作業内容**: プルダウンから選択（「その他」は手入力）
- **時間**: 作業時間（0.5時間刻み）
- **金額**: グローバル時給により自動計算

### 3. **NEW: 交通費の入力**
- **日付**: 交通費発生日
- **場所**: 「東京駅→大阪駅」等の移動区間
- **交通手段**: プルダウンから選択
- **金額**: 実際にかかった交通費
- **メモ**: 「会議参加のため往復」等の詳細

### 4. **PDF出力（1ページ最適化）**
- **印刷プレビュー**: 必ずA4サイズ1ページに収まる
- **高品質出力**: 11pxフォント・最適化レイアウト
- **プロ仕様**: 業務委託標準書式準拠

## 🔧 最新の実装状況

### ✅ **完了済み（2024年9月30日最新）**

#### 1. 交通費機能の完全実装
- **入力画面**: 5項目（日付・場所・交通手段・金額・メモ）
- **8種類交通手段**: プルダウン選択対応
- **自動計算**: 交通費小計の自動更新
- **データ保存**: 個人識別子別の完全分離保存

#### 2. PDF1ページ最適化
- **フォントサイズ**: 11px基本・テーブル10px・ヘッダー20px
- **余白調整**: 15px統一余白
- **行間最適化**: 1.3倍行間でコンパクト化
- **テーブル調整**: セル内余白3px・マージン8px

#### 3. 統合計算システム
- **作業代金**: 時給×時間（税込み・税抜き対応）
- **交通費**: 実費合計（非課税）
- **消費税**: 作業代金のみに適用
- **総合計**: 作業代金（税込）+ 交通費

#### 4. プレビュー画面の強化
- **2つのテーブル**: 作業項目・交通費を分離表示
- **詳細合計**: 作業代金・交通費・消費税・合計を明確表示
- **PDF最適化**: 印刷時の美しいレイアウト

## 📋 請求書出力例

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
                   請求書
                 No. INV-20240930-001
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

                            株式会社EduSupport　様
                    東京都新宿区西新宿3-3-13 西新宿水間ビル6F

                           発行日: 2024年9月30日
                         支払期限: 2024年10月31日

【作業項目】
┌──────┬────────────┬──────┬──────┬────────┐
│日付    │作業内容        │時間  │時給  │金額      │
├──────┼────────────┼──────┼──────┼────────┤
│9/25    │ウェブ記事作成  │8.0h  │¥5,000│¥40,000   │
│9/26    │ミーティング参加│2.0h  │¥5,000│¥10,000   │
└──────┴────────────┴──────┴──────┴────────┘

【交通費】
┌──────┬────────────┬────────┬────────┬──────────┐
│日付    │場所            │交通手段│金額    │メモ        │
├──────┼────────────┼────────┼────────┼──────────┤
│9/25    │東京駅→大阪駅  │新幹線  │¥13,320│会議参加往復│
│9/26    │大阪駅→京都駅  │電車    │¥560    │訪問        │
└──────┴────────────┴────────┴────────┴──────────┘

                                    作業代金: ¥50,000
                                    交通費:   ¥13,880
                                    消費税:    ¥5,000
                                    ─────────────────
                                    合計:     ¥68,880
```

## 🏆 システムの特徴

### 💼 業務委託に特化
- **交通費対応**: 実費精算の正確な記録
- **非課税処理**: 交通費は消費税対象外として適切に分離
- **詳細記録**: 場所・手段・メモで監査対応

### 📄 PDF最適化
- **1ページ保証**: 必ずA4サイズ1ページに収まる
- **印刷品質**: プロフェッショナルな仕上がり
- **レイアウト**: 業務委託標準書式準拠

### 🔒 プライバシー・効率性
- **完全分離**: スタッフ別のデータ分離システム
- **ローカル保存**: サーバーにデータを送信しない
- **効率入力**: プルダウン選択で入力時間短縮

## 📊 技術仕様（最新）

### 🛠 技術スタック
- **フロントエンド**: Vanilla JavaScript + TailwindCSS
- **バックエンド**: Hono (TypeScript) + Cloudflare Workers
- **PDF出力**: ブラウザ標準印刷機能（最適化済み）
- **データ保存**: LocalStorage（個人識別子別分離）

### 📊 データ構造
```javascript
// 保存データ構造（最新版）
{
  userIdentifier: "yamada01",
  hourlyRate: "5000",
  workItems: [
    {
      date: "2024-09-30",
      descriptionSelect: "ウェブ記事作成",
      hours: "8"
    }
  ],
  transportItems: [
    {
      date: "2024-09-30",
      location: "東京駅→大阪駅",
      method: "新幹線",
      amount: "13320",
      memo: "会議参加のため往復"
    }
  ]
}
```

### 🔍 機能別URI
- **メインページ**: `/`
- **API Health**: `/api/health`
- **JavaScript**: `/static/app.js`
- **CSS**: `/static/styles.css`

## 🚀 デプロイ情報
- **プラットフォーム**: Cloudflare Pages/Workers
- **ステータス**: ✅ アクティブ（開発環境）
- **最終更新**: 2024年9月30日
- **バージョン**: v9.0（EduSupport専用版）

## 🎯 推奨する使用方法
1. **基本設定**: 個人識別・時給を設定
2. **作業記録**: プルダウンで効率的に作業内容を入力
3. **交通費記録**: 実費を正確に記録（場所・手段・メモ）
4. **リアルタイム確認**: プレビューで仕上がりを常時確認
5. **PDF出力**: 1ページに収まった美しい請求書をダウンロード

## ✨ 新機能のメリット

### 💰 **交通費対応の価値**
- **正確な実費精算**: 場所・手段・金額を詳細記録
- **税務対応**: 交通費非課税・作業代金課税の適切な分離
- **監査対応**: メモ欄による詳細な移動理由記録

### 📄 **PDF最適化の価値**
- **印刷コスト削減**: 必ず1ページに収まるため用紙節約
- **見やすさ向上**: 最適化されたフォント・レイアウト
- **プロ品質**: 業務委託の正式書類として十分な品質

---

**⭐ 交通費対応とPDF最適化により、業務委託の請求書作成がさらに完璧に！1ページに収まる美しい請求書で、プロフェッショナルな印象を与えられます！**# テスト用更新
# デプロイテスト Wed Oct 15 09:27:09 UTC 2025
